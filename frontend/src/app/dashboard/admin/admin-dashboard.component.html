<div class="admin-container">
  <!-- Sidebar -->
  <aside class="sidebar" [class.collapsed]="sidebarCollapsed()">
    <div class="sidebar-header">
      <div class="logo" [class.collapsed]="sidebarCollapsed()">
        <h2>{{ sidebarCollapsed() ? 'V' : 'PS' }}</h2>
      </div>
      <button class="collapse-btn" (click)="toggleSidebar()">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
    </div>

    <nav class="sidebar-nav">
      <button
        class="nav-item"
        [class.active]="activeSection() === 'dashboard'"
        (click)="setActiveSection('dashboard')"
        title="Dashboard"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <rect x="3" y="3" width="7" height="7"></rect>
          <rect x="14" y="3" width="7" height="7"></rect>
          <rect x="14" y="14" width="7" height="7"></rect>
          <rect x="3" y="14" width="7" height="7"></rect>
        </svg>
        <span>Dashboard</span>
      </button>

      <button
        class="nav-item"
        [class.active]="activeSection() === 'users'"
        (click)="setActiveSection('users')"
        title="Users Management"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
        <span>Users Management</span>
      </button>

      <button
        class="nav-item"
        [class.active]="activeSection() === 'courses'"
        (click)="setActiveSection('courses')"
        title="Courses Management"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
          <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
        </svg>
        <span>Courses Management</span>
      </button>

      <button
        class="nav-item"
        [class.active]="activeSection() === 'analytics'"
        (click)="setActiveSection('analytics')"
        title="Analytics"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
        </svg>
        <span>Analytics</span>
      </button>

      <button
        class="nav-item"
        [class.active]="activeSection() === 'audit'"
        (click)="setActiveSection('audit')"
        title="Audit Logs"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        <span>Audit Logs</span>
      </button>

      <button
        class="nav-item"
        [class.active]="activeSection() === 'settings'"
        (click)="setActiveSection('settings')"
        title="Settings"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <circle cx="12" cy="12" r="3"></circle>
          <path
            d="M12 1v6m0 6v6m0-13a2 2 0 0 0-2 2h4a2 2 0 0 0-2-2zm0 18a2 2 0 0 1-2-2h4a2 2 0 0 1-2 2z"
          ></path>
          <path d="M17 7a5 5 0 0 0-10 0M7 17a5 5 0 0 0 10 0"></path>
        </svg>
        <span>Settings</span>
      </button>
    </nav>

    <div class="sidebar-footer">
      <button class="nav-item logout" (click)="onLogout()" title="Logout">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path>
          <line x1="12" y1="2" x2="12" y2="12"></line>
        </svg>
        <span>Logout</span>
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content" [class.sidebar-collapsed]="sidebarCollapsed()">
    <!-- Top Header -->
    <header class="top-header">
      <div class="header-left">
        <h1 class="section-title">
          {{
            activeSection() === 'dashboard'
              ? 'Dashboard'
              : activeSection() === 'users'
              ? 'Users Management'
              : activeSection() === 'courses'
              ? 'Courses Management'
              : activeSection() === 'analytics'
              ? 'Analytics'
              : activeSection() === 'audit'
              ? 'Audit Logs'
              : 'Settings'
          }}
        </h1>
      </div>

      <div class="header-right">
        <app-theme-toggle></app-theme-toggle>

        @if (currentUser()) {
        <div class="user-menu">
          <div class="user-info" (click)="toggleUserDropdown()">
            <div class="user-avatar">
              {{ currentUser()!.firstName?.charAt(0) || ''
              }}{{ currentUser()!.lastName?.charAt(0) || '' }}
            </div>
            <div class="user-details">
              <span class="user-name"
                >{{ currentUser()!.firstName }} {{ currentUser()!.lastName }}</span
              >
              <span class="user-role">{{ currentUser()!.role }}</span>
            </div>
          </div>

          @if (showUserDropdown()) {
          <div class="user-dropdown">
            <div class="dropdown-header">
              <div class="dropdown-user-name">
                {{ currentUser()!.firstName }} {{ currentUser()!.lastName }}
              </div>
              <div class="dropdown-user-role">{{ currentUser()!.role }}</div>
            </div>
            <button
              class="dropdown-item"
              (click)="setActiveSection('settings'); showUserDropdown.set(false)"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 1v6m0 6v6"></path>
              </svg>
              Settings
            </button>
            <button class="dropdown-item logout" (click)="onLogout()">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
              </svg>
              Logout
            </button>
          </div>
          }
        </div>
        }
      </div>
    </header>

    <!-- Content Area -->
    <div class="content-wrapper">
      <!-- Dashboard Section -->
      @if (activeSection() === 'dashboard') {
      <section class="section-content">
        <div class="welcome-banner">
          <h2>{{ getGreeting() }}, {{ currentUser()?.firstName }}!</h2>
          <p>Here's what's happening with your platform today</p>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
          <div class="stat-card">
            <div
              class="stat-icon"
              style="background: linear-gradient(135deg, #8b7dff 0%, #b794f6 100%)"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="28"
                height="28"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
              </svg>
            </div>
            <div class="stat-info">
              <h3>{{ (platformStats$ | async)?.totalUsers ?? 0 }}</h3>
              <p>Total Users</p>
              <span class="stat-change positive">+12% this month</span>
            </div>
          </div>

          <div class="stat-card">
            <div
              class="stat-icon"
              style="background: linear-gradient(135deg, #48bb78 0%, #38a169 100%)"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="28"
                height="28"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
              </svg>
            </div>
            <div class="stat-info">
              <h3>{{ (platformStats$ | async)?.totalCourses ?? 0 }}</h3>
              <p>Total Courses</p>
              <span class="stat-change positive">+8% this month</span>
            </div>
          </div>

          <div class="stat-card">
            <div
              class="stat-icon"
              style="background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%)"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="28"
                height="28"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
              </svg>
            </div>
            <div class="stat-info">
              <h3>{{ (platformStats$ | async)?.totalInstructors ?? 0 }}</h3>
              <p>Instructors</p>
              <span class="stat-change positive">+3 this week</span>
            </div>
          </div>

          <div class="stat-card">
            <div
              class="stat-icon"
              style="background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%)"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="28"
                height="28"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
            </div>
            <div class="stat-info">
              <h3>{{ (platformStats$ | async)?.totalStudents ?? 0 }}</h3>
              <p>Students</p>
              <span class="stat-change positive">+15% this month</span>
            </div>
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="dashboard-grid">
          <div class="card">
            <div class="card-header">
              <h3>Recent Activity</h3>
              <button class="btn-text" (click)="setActiveSection('audit')">View All</button>
            </div>
            <div class="activity-list">
              @if (recentActivity$ | async; as $activities) { @for (activity of $activities.slice(0,
              5); track activity.id) {
              <div class="activity-item">
                <div class="activity-icon" [class]="'icon-' + activity.type">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <circle cx="12" cy="12" r="10"></circle>
                  </svg>
                </div>
                <div class="activity-content">
                  <p class="activity-action">{{ activity.action }}</p>
                  <div class="activity-meta">
                    <span class="activity-user">{{ activity.user }}</span>
                    <span class="activity-time">{{ activity.time }}</span>
                  </div>
                </div>
              </div>
              } @empty {
              <div class="activity-item">
                <p>No recent activity</p>
              </div>
              } }
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3>Quick Stats</h3>
            </div>
            <div class="quick-stats">
              <div class="quick-stat-item">
                <span class="label">Active Courses</span>
                <span class="value">{{ (platformStats$ | async)?.totalCourses ?? 0 }}</span>
              </div>
              <div class="quick-stat-item">
                <span class="label">Pending Approvals</span>
                <span class="value warning">6</span>
              </div>
              <div class="quick-stat-item">
                <span class="label">Total Enrollments</span>
                <span class="value">1,247</span>
              </div>
              <div class="quick-stat-item">
                <span class="label">Completion Rate</span>
                <span class="value success">78%</span>
              </div>
            </div>
          </div>
        </div>
      </section>
      }

      <!-- Users Management Section -->
      @if (activeSection() === 'users') {
      <section class="section-content">
        <div class="table-controls">
          <div class="search-box">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            <input
              type="text"
              placeholder="Search by name or email..."
              [value]="userSearchQuery()"
              (input)="onUserSearchChange($any($event.target).value)"
            />
          </div>

          <div class="filters">
            <select
              [value]="userRoleFilter()"
              (change)="onUserRoleFilterChange($any($event.target).value)"
            >
              <option value="all">All Roles</option>
              <option value="student">Student</option>
              <option value="instructor">Instructor</option>
            </select>

            <select
              [value]="userStatusFilter()"
              (change)="onUserStatusFilterChange($any($event.target).value)"
            >
              <option value="all">All Status</option>
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
            </select>
          </div>
        </div>

        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th (click)="sortUsers('name')" class="sortable">
                  Name @if (userSortBy() === 'name') {
                  <span class="sort-icon">{{ userSortOrder() === 'asc' ? 'â†‘' : 'â†“' }}</span>
                  }
                </th>
                <th (click)="sortUsers('email')" class="sortable">
                  Email @if (userSortBy() === 'email') {
                  <span class="sort-icon">{{ userSortOrder() === 'asc' ? 'â†‘' : 'â†“' }}</span>
                  }
                </th>
                <th (click)="sortUsers('role')" class="sortable">
                  Role @if (userSortBy() === 'role') {
                  <span class="sort-icon">{{ userSortOrder() === 'asc' ? 'â†‘' : 'â†“' }}</span>
                  }
                </th>
                <th>Status</th>
                <th (click)="sortUsers('joinedDate')" class="sortable">
                  Joined @if (userSortBy() === 'joinedDate') {
                  <span class="sort-icon">{{ userSortOrder() === 'asc' ? 'â†‘' : 'â†“' }}</span>
                  }
                </th>
                <th class="actions-col">Actions</th>
              </tr>
            </thead>
            <tbody>
              @if (allUsers$ | async; as $users) { @for (user of getFilteredUsers($users); track
              user.id) {
              <tr>
                <td>
                  <div class="user-cell">
                    <div class="user-avatar-small">
                      {{ (user.firstName + user.lastName).charAt(0) }}
                    </div>
                    <span>{{ user.firstName }} {{ user.lastName }}</span>
                  </div>
                </td>
                <td>{{ user.email }}</td>
                <td>
                  <span class="badge" [class]="'badge-' + user.role">{{ user.role }}</span>
                </td>
                <td>
                  <span
                    class="status-badge"
                    [class]="'status-' + (user.isActive ? 'active' : 'inactive')"
                    >{{ user.isActive ? 'active' : 'inactive' }}</span
                  >
                </td>
                <td>{{ user.createdAt }}</td>
                <td class="actions-col">
                  <button class="btn-icon" title="View" (click)="viewUser(user.id)">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                      <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                  </button>
                  <button class="btn-icon" title="Edit" (click)="editUser(user.id)">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                  </button>
                  <button class="btn-icon" title="Delete" (click)="confirmDeleteUser(user.id)">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path
                        d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                      ></path>
                      <line x1="10" y1="11" x2="10" y2="17"></line>
                      <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                  </button>
                </td>
              </tr>
              } @empty {
              <tr>
                <td colspan="6" class="empty-state">No users found</td>
              </tr>
              } }
            </tbody>
          </table>
        </div>
      </section>
      }

      <!-- Courses Management Section -->
      @if (activeSection() === 'courses') {
      <section class="section-content">
        <div class="table-controls">
          <div class="search-box">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            <input
              type="text"
              placeholder="Search courses..."
              [value]="courseSearchQuery()"
              (input)="onCourseSearchChange($any($event.target).value)"
            />
          </div>

          <div class="filters">
            <select
              [value]="courseStatusFilter()"
              (change)="onCourseStatusFilterChange($any($event.target).value)"
            >
              <option value="all">All Status</option>
              <option value="active">Active</option>
              <option value="pending">Pending</option>
              <option value="draft">Draft</option>
            </select>
          </div>
        </div>

        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th (click)="sortCourses('title')" class="sortable">
                  Title @if (courseSortBy() === 'title') {
                  <span class="sort-icon">{{ courseSortOrder() === 'asc' ? 'â†‘' : 'â†“' }}</span>
                  }
                </th>
                <th (click)="sortCourses('instructor')" class="sortable">
                  Instructor @if (courseSortBy() === 'instructor') {
                  <span class="sort-icon">{{ courseSortOrder() === 'asc' ? 'â†‘' : 'â†“' }}</span>
                  }
                </th>
                <th>Status</th>
                <th (click)="sortCourses('students')" class="sortable">
                  Students @if (courseSortBy() === 'students') {
                  <span class="sort-icon">{{ courseSortOrder() === 'asc' ? 'â†‘' : 'â†“' }}</span>
                  }
                </th>
                <th (click)="sortCourses('createdDate')" class="sortable">
                  Created @if (courseSortBy() === 'createdDate') {
                  <span class="sort-icon">{{ courseSortOrder() === 'asc' ? 'â†‘' : 'â†“' }}</span>
                  }
                </th>
                <th class="actions-col">Actions</th>
              </tr>
            </thead>
            <tbody>
              @if (allCourses$ | async; as $courses) { @for (course of getFilteredCourses($courses);
              track course.id) {
              <tr>
                <td>
                  <strong>{{ course.title }}</strong>
                </td>
                <td>{{ course.instructor_name }}</td>
                <td>
                  <span class="status-badge" [class]="'status-' + course.status">{{
                    course.status
                  }}</span>
                </td>
                <td>{{ course.enrollment_count }}</td>
                <td>{{ course.created_at }}</td>
                <td class="actions-col">
                  <button class="btn-icon" title="View" (click)="viewCourse(course.id)">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                      <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                  </button>
                  @if (course.status === 'pending') {
                  <button
                    class="btn-icon success"
                    title="Approve"
                    (click)="approveCourse(course.id)"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                  </button>
                  }
                  <button class="btn-icon" title="Edit" (click)="editCourse(course.id)">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                  </button>
                  <button
                    class="btn-icon"
                    title="Delete"
                    (click)="confirmDeleteCourse(course.id, course.title)"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path
                        d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                      ></path>
                      <line x1="10" y1="11" x2="10" y2="17"></line>
                      <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                  </button>
                </td>
              </tr>
              } @empty {
              <tr>
                <td colspan="6" class="empty-state">No courses found</td>
              </tr>
              } }
            </tbody>
          </table>
        </div>
      </section>
      }

      <!-- Analytics Section with Chart.js -->
      @if (activeSection() === 'analytics') {
      <section class="section-content analytics-section">
        <!-- Overview Stats Row -->
        <div class="stats-overview-row">
          <div class="overview-stat-card">
            <div class="stat-header">
              <div
                class="stat-icon-wrapper"
                style="background: linear-gradient(135deg, #8b7dff 0%, #b794f6 100%)"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="4"></circle>
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
              </div>
              <span class="stat-label">Total Users</span>
            </div>
            <div class="stat-value">{{ (platformStats$ | async)?.totalUsers ?? 0 }}</div>
            <div class="stat-trend positive">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
              </svg>
              +12% from last month
            </div>
          </div>

          <div class="overview-stat-card">
            <div class="stat-header">
              <div
                class="stat-icon-wrapper"
                style="background: linear-gradient(135deg, #48bb78 0%, #38a169 100%)"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                  <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                </svg>
              </div>
              <span class="stat-label">Total Courses</span>
            </div>
            <div class="stat-value">{{ (platformStats$ | async)?.totalCourses ?? 0 }}</div>
            <div class="stat-trend positive">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
              </svg>
              +8% from last month
            </div>
          </div>

          <div class="overview-stat-card">
            <div class="stat-header">
              <div
                class="stat-icon-wrapper"
                style="background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%)"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                  <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                </svg>
              </div>
              <span class="stat-label">Instructors</span>
            </div>
            <div class="stat-value">{{ (platformStats$ | async)?.totalInstructors ?? 0 }}</div>
            <div class="stat-trend positive">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
              </svg>
              +3 this week
            </div>
          </div>

          <div class="overview-stat-card">
            <div class="stat-header">
              <div
                class="stat-icon-wrapper"
                style="background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%)"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                  <circle cx="12" cy="7" r="4"></circle>
                </svg>
              </div>
              <span class="stat-label">Students</span>
            </div>
            <div class="stat-value">{{ (platformStats$ | async)?.totalStudents ?? 0 }}</div>
            <div class="stat-trend positive">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
              </svg>
              +15% from last month
            </div>
          </div>
        </div>

        <!-- Charts Grid -->
        <div class="analytics-charts-grid">
          <!-- User Distribution Chart -->
          <div class="chart-card">
            <div class="card-header">
              <h3>User Distribution</h3>
              <span class="chart-subtitle">Role breakdown</span>
            </div>
            <div class="chart-canvas-wrapper">
              <canvas #userDistributionChart></canvas>
            </div>
          </div>

          <!-- Course Status Chart -->
          <div class="chart-card">
            <div class="card-header">
              <h3>Course Status</h3>
              <span class="chart-subtitle">Status breakdown</span>
            </div>
            <div class="chart-canvas-wrapper">
              <canvas #courseStatusChart></canvas>
            </div>
          </div>

          <!-- Growth Trend Chart - Full Width -->
          <div class="chart-card full-width-chart">
            <div class="card-header">
              <h3>Growth Trends</h3>
              <span class="chart-subtitle">Last 7 months</span>
            </div>
            <div class="chart-canvas-wrapper large">
              <canvas #growthTrendChart></canvas>
            </div>
          </div>

          <!-- Enrollment by Category Chart -->
          <div class="chart-card full-width-chart">
            <div class="card-header">
              <h3>Enrollments by Category</h3>
              <span class="chart-subtitle">Top 5 categories</span>
            </div>
            <div class="chart-canvas-wrapper large">
              <canvas #enrollmentChart></canvas>
            </div>
          </div>
        </div>

        <!-- Performance Metrics -->
        <div class="metrics-grid">
          <div class="metric-card">
            <div
              class="metric-icon"
              style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="28"
                height="28"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polygon
                  points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"
                ></polygon>
              </svg>
            </div>
            <div class="metric-content">
              <div class="metric-value">4.7 / 5.0</div>
              <div class="metric-label">Avg Course Rating</div>
              <div class="metric-subtext">Based on student reviews</div>
            </div>
          </div>

          <div class="metric-card">
            <div
              class="metric-icon"
              style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%)"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="28"
                height="28"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
              </svg>
            </div>
            <div class="metric-content">
              <div class="metric-value">78%</div>
              <div class="metric-label">Completion Rate</div>
              <div class="metric-subtext">Average across all courses</div>
            </div>
          </div>

          <div class="metric-card">
            <div
              class="metric-icon"
              style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%)"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="28"
                height="28"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
            </div>
            <div class="metric-content">
              <div class="metric-value">92%</div>
              <div class="metric-label">User Satisfaction</div>
              <div class="metric-subtext">Based on platform surveys</div>
            </div>
          </div>

          <div class="metric-card">
            <div
              class="metric-icon"
              style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="28"
                height="28"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
              </svg>
            </div>
            <div class="metric-content">
              <div class="metric-value">1,247</div>
              <div class="metric-label">Total Enrollments</div>
              <div class="metric-subtext">Across all courses</div>
            </div>
          </div>
        </div>

        <!-- Additional Insights -->
        <div class="insights-section">
          <div class="card insight-card">
            <div class="card-header">
              <h3>Key Insights</h3>
            </div>
            <div class="insights-list">
              <div class="insight-item">
                <div class="insight-icon success">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                </div>
                <div class="insight-content">
                  <strong>User Growth Accelerating</strong>
                  <p>12% increase in new users this month, highest in 6 months</p>
                </div>
              </div>

              <div class="insight-item">
                <div class="insight-icon info">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="16" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                  </svg>
                </div>
                <div class="insight-content">
                  <strong>Course Quality High</strong>
                  <p>Average rating of 4.7/5.0 shows excellent content quality</p>
                </div>
              </div>

              <div class="insight-item">
                <div class="insight-icon warning">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"
                    ></path>
                    <line x1="12" y1="9" x2="12" y2="13"></line>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                  </svg>
                </div>
                <div class="insight-content">
                  <strong>Pending Approvals</strong>
                  <p>6 courses awaiting approval - review recommended</p>
                </div>
              </div>

              <div class="insight-item">
                <div class="insight-icon success">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                    <polyline points="17 6 23 6 23 12"></polyline>
                  </svg>
                </div>
                <div class="insight-content">
                  <strong>Strong Engagement</strong>
                  <p>78% completion rate indicates high student engagement</p>
                </div>
              </div>
            </div>
          </div>

          <div class="card insight-card">
            <div class="card-header">
              <h3>Recommendations</h3>
            </div>
            <div class="insights-list">
              <div class="insight-item">
                <div class="insight-number">1</div>
                <div class="insight-content">
                  <strong>Review Pending Courses</strong>
                  <p>Approve or provide feedback on the 6 pending courses</p>
                </div>
              </div>

              <div class="insight-item">
                <div class="insight-number">2</div>
                <div class="insight-content">
                  <strong>Recruit More Instructors</strong>
                  <p>With growing student base, onboard more quality instructors</p>
                </div>
              </div>

              <div class="insight-item">
                <div class="insight-number">3</div>
                <div class="insight-content">
                  <strong>Expand Course Categories</strong>
                  <p>Consider adding new categories based on user demand</p>
                </div>
              </div>

              <div class="insight-item">
                <div class="insight-number">4</div>
                <div class="insight-content">
                  <strong>Monitor Archived Courses</strong>
                  <p>Review archived courses to identify improvement opportunities</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      }

      <!-- Audit Logs Section -->
      @if (activeSection() === 'audit') {
      <section class="section-content">
        <div class="card">
          <div class="card-header">
            <h3>System Audit Logs</h3>
            <span class="badge-info">Last 50 days</span>
          </div>

          @if (auditLogsLoading$ | async) {
          <div class="loading-state">
            <p>Loading audit logs...</p>
          </div>
          } @else if (auditLogsError$ | async; as error) {
          <div class="error-state">
            <p>{{ error }}</p>
          </div>
          } @else {
          <div class="table-container">
            <table class="data-table audit-table">
              <thead>
                <tr>
                  <th>Timestamp</th>
                  <th>Action</th>
                  <th>User</th>
                  <th>Details</th>
                  <th>IP Address</th>
                </tr>
              </thead>
              <tbody>
                @if (auditLogs$ | async; as $logs) { @for (log of $logs; track log.id) {
                <tr>
                  <td>{{ log.timestamp }}</td>
                  <td>
                    <span class="action-badge">{{ log.action }}</span>
                  </td>
                  <td>{{ log.user }}</td>
                  <td>{{ log.details }}</td>
                  <td>
                    <code>{{ log.ip_address }}</code>
                  </td>
                </tr>
                } @empty {
                <tr>
                  <td colspan="5" class="empty-state">No audit logs found</td>
                </tr>
                } }
              </tbody>
            </table>
          </div>
          }
        </div>
      </section>
      }

      <!-- Settings Section -->
      @if (activeSection() === 'settings') {
      <section class="section-content">
        <div class="settings-grid">
          <div class="card">
            <div class="card-header">
              <h3>Profile Settings</h3>
            </div>
            <div class="settings-form">
              <div class="form-group">
                <label>First Name</label>
                <input type="text" [value]="currentUser()?.firstName" readonly />
              </div>
              <div class="form-group">
                <label>Last Name</label>
                <input type="text" [value]="currentUser()?.lastName" readonly />
              </div>
              <div class="form-group">
                <label>Email</label>
                <input type="email" [value]="currentUser()?.email" readonly />
              </div>
              <div class="form-group">
                <label>Role</label>
                <input type="text" [value]="currentUser()?.role" readonly />
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3>Platform Settings</h3>
            </div>
            <div class="settings-form">
              <div class="form-group">
                <label>Platform Name</label>
                <input type="text" value="VISNET" />
              </div>
              <div class="form-group">
                <label>Support Email</label>
                <input type="email" value="support@visnet.com" />
              </div>
              <div class="form-group checkbox-group">
                <input type="checkbox" id="autoApprove" />
                <label for="autoApprove">Auto-approve new courses</label>
              </div>
              <div class="form-group checkbox-group">
                <input type="checkbox" id="emailNotifications" checked />
                <label for="emailNotifications">Enable email notifications</label>
              </div>
              <button class="btn-primary">Save Settings</button>
            </div>
          </div>
        </div>
      </section>
      }
    </div>
  </main>
  <!-- Delete User Confirmation Dialog -->
  <app-confirmation-dialog
    [isOpen]="showDeleteUserDialog"
    [isLoading]="isDeleting"
    title="Delete User"
    message="Are you sure you want to delete this user?"
    subMessage="This action cannot be undone and will permanently remove the user and all associated data."
    confirmText="Delete"
    cancelText="Cancel"
    loadingText="Deleting..."
    type="danger"
    (confirm)="deleteUser()"
    (cancel)="cancelDeleteUser()"
  ></app-confirmation-dialog>

  <!-- Delete Course Confirmation Dialog -->
  <app-confirmation-dialog
    [isOpen]="showDeleteCourseDialog"
    [isLoading]="isDeleting"
    title="Delete Course"
    [message]="'Are you sure you want to delete ' + selectedCourseName() + '?'"
    subMessage="This action cannot be undone and will remove all associated data including lessons, quizzes, and enrollments."
    confirmText="Delete"
    cancelText="Cancel"
    loadingText="Deleting..."
    type="danger"
    (confirm)="deleteCourse()"
    (cancel)="cancelDeleteCourse()"
  ></app-confirmation-dialog>

  <!-- Success Dialog -->
  <app-confirmation-dialog
    [isOpen]="showSuccessDialog"
    title="Success"
    [message]="successMessage()"
    confirmText="OK"
    type="info"
    (confirm)="closeSuccessDialog()"
  ></app-confirmation-dialog>

  <!-- Error Dialog -->
  <app-confirmation-dialog
    [isOpen]="showErrorDialog"
    title="Error"
    [message]="errorMessage()"
    confirmText="OK"
    type="danger"
    (confirm)="closeErrorDialog()"
  ></app-confirmation-dialog>
</div>
