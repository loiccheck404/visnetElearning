<!-- Tabs Navigation -->
<div class="management-tabs">
  <button 
    class="tab-btn" 
    [class.active]="activeTab() === 'users'"
    (click)="switchTab('users')">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
      <circle cx="9" cy="7" r="4"></circle>
      <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
      <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
    </svg>
    Users
  </button>
  <button 
    class="tab-btn" 
    [class.active]="activeTab() === 'courses'"
    (click)="switchTab('courses')">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
      <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
    </svg>
    Courses
  </button>
  <button 
    class="tab-btn" 
    [class.active]="activeTab() === 'analytics'"
    (click)="switchTab('analytics')">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
    </svg>
    Analytics
  </button>
</div>

<!-- USERS TAB -->
@if (activeTab() === 'users') {
<div class="tab-content users-content">
  <!-- Search and Filters -->
  <div class="controls-bar">
    <div class="search-box">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"></circle>
        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
      </svg>
      <input 
        type="text" 
        placeholder="Search by name or email..." 
        [(ngModel)]="userSearchQuery"
        (input)="onUserSearchChange()">
    </div>

    <div class="filter-group">
      <select [(ngModel)]="userRoleFilter" (change)="onUserRoleFilterChange()" class="filter-select">
        <option value="all">All Roles</option>
        <option value="student">Students</option>
        <option value="instructor">Instructors</option>
        <option value="admin">Admins</option>
      </select>

      <select [(ngModel)]="userStatusFilter" (change)="onUserStatusFilterChange()" class="filter-select">
        <option value="all">All Status</option>
        <option value="active">Active</option>
        <option value="inactive">Inactive</option>
        <option value="suspended">Suspended</option>
      </select>
    </div>
  </div>

  <!-- Users Table -->
  @if (isLoadingUsers()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Loading users...</p>
    </div>
  } @else if (filteredUsers().length > 0) {
    <div class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Role</th>
            <th>Status</th>
            <th>Joined</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (user of filteredUsers(); track user.id) {
            <tr>
              <td>
                <div class="user-cell">
                  <div class="avatar">{{ user.firstName.charAt(0) }}{{ user.lastName.charAt(0) }}</div>
                  <span>{{ user.firstName }} {{ user.lastName }}</span>
                </div>
              </td>
              <td>{{ user.email }}</td>
              <td>
                <span class="role-badge" [class]="'role-' + user.role">
                  {{ user.role }}
                </span>
              </td>
              <td>
                <select 
                  [ngModel]="user.status" 
                  (change)="changeUserStatus(user.id, $event)"
                  class="status-select">
                  <option value="active">Active</option>
                  <option value="inactive">Inactive</option>
                  <option value="suspended">Suspended</option>
                </select>
              </td>
              <td>{{ user.createdAt | slice:0:10 }}</td>
              <td class="actions-cell">
                <button class="action-btn view" (click)="openUserModal(user)" title="View">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                </button>
                <button class="action-btn delete" (click)="deleteUser(user.id)" title="Delete">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                  </svg>
                </button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  } @else {
    <div class="empty-state">
      <p>No users found</p>
    </div>
  }
</div>
}

<!-- COURSES TAB -->
@if (activeTab() === 'courses') {
<div class="tab-content courses-content">
  <!-- Search and Filters -->
  <div class="controls-bar">
    <div class="search-box">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"></circle>
        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
      </svg>
      <input 
        type="text" 
        placeholder="Search by title or instructor..." 
        [(ngModel)]="courseSearchQuery"
        (input)="onCourseSearchChange()">
    </div>

    <div class="filter-group">
      <select [(ngModel)]="courseCategoryFilter" (change)="onCourseCategoryFilterChange()" class="filter-select">
        <option value="all">All Categories</option>
        <option value="Web Development">Web Development</option>
        <option value="Backend Development">Backend Development</option>
        <option value="Data Science">Data Science</option>
        <option value="Design">Design</option>
      </select>

      <select [(ngModel)]="courseStatusFilter" (change)="onCourseStatusFilterChange()" class="filter-select">
        <option value="all">All Status</option>
        <option value="published">Published</option>
        <option value="draft">Draft</option>
        <option value="archived">Archived</option>
      </select>
    </div>
  </div>

  <!-- Courses Table -->
  @if (isLoadingCourses()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Loading courses...</p>
    </div>
  } @else if (filteredCourses().length > 0) {
    <div class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>Title</th>
            <th>Instructor</th>
            <th>Category</th>
            <th>Students</th>
            <th>Status</th>
            <th>Revenue</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (course of filteredCourses(); track course.id) {
            <tr>
              <td class="title-cell">{{ course.title }}</td>
              <td>{{ course.instructor }}</td>
              <td>{{ course.category }}</td>
              <td>{{ course.students }}</td>
              <td>
                <select 
                  [ngModel]="course.status" 
                  (change)="changeCourseStatus(course.id, $event)"
                  class="status-select">
                  <option value="published">Published</option>
                  <option value="draft">Draft</option>
                  <option value="archived">Archived</option>
                </select>
              </td>
              <td class="revenue-cell">${{ course.revenue || 0 | number:'1.0-0' }}</td>
              <td class="actions-cell">
                <button class="action-btn view" (click)="openCourseModal(course)" title="View">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                </button>
                <button class="action-btn delete" (click)="deleteCourse(course.id)" title="Delete">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                  </svg>
                </button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  } @else {
    <div class="empty-state">
      <p>No courses found</p>
    </div>
  }
</div>
}

<!-- ANALYTICS TAB -->
@if (activeTab() === 'analytics') {
<div class="tab-content analytics-content">
  @if (isLoadingAnalytics()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Loading analytics...</p>
    </div>
  } @else if (analytics()) {
    <div class="analytics-container">
      <!-- Key Metrics -->
      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-label">Total Revenue</div>
          <div class="metric-value">${{ analytics()!.totalRevenue | number:'1.0-0' }}</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Total Enrollments</div>
          <div class="metric-value">{{ analytics()!.totalEnrollments }}</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Avg Course Rating</div>
          <div class="metric-value">{{ analytics()!.avgCourseRating | number:'1.1-1' }}/5</div>
        </div>
      </div>

      <!-- Top Courses -->
      <div class="analytics-section">
        <h3>Top Performing Courses</h3>
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Course</th>
                <th>Enrollments</th>
                <th>Revenue</th>
              </tr>
            </thead>
            <tbody>
              @for (course of analytics()!.coursePerformance; track $index) {
                <tr>
                  <td>{{ course.title }}</td>
                  <td>{{ course.enrollments }}</td>
                  <td>${{ course.revenue | number:'1.0-0' }}</td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>

      <!-- Top Instructors -->
      <div class="analytics-section">
        <h3>Top Instructors</h3>
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Courses</th>
                <th>Students</th>
                <th>Revenue</th>
              </tr>
            </thead>
            <tbody>
              @for (instructor of analytics()!.topInstructors; track $index) {
                <tr>
                  <td>{{ instructor.name }}</td>
                  <td>{{ instructor.courses }}</td>
                  <td>{{ instructor.students }}</td>
                  <td>${{ instructor.revenue | number:'1.0-0' }}</td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>

      <!-- Export Button -->
      <div class="export-section">
        <button class="export-btn" (click)="exportAnalytics()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
          Export to CSV
        </button>
      </div>
    </div>
  }
</div>
}