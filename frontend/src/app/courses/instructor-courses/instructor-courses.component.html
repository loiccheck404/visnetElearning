<div class="dashboard-container">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="logo">
        <h2>VISNET</h2>
      </div>
      <nav class="nav-links">
        <a routerLink="/dashboard/instructor">Home</a>
        <a routerLink="/dashboard/instructor/courses" routerLinkActive="active">My Courses</a>
        <a routerLink="/dashboard/instructor/students">Students</a>
        <a routerLink="/dashboard/profile">Profile</a>
      </nav>
      <div class="user-menu">
        @if (currentUser()) {
        <app-theme-toggle></app-theme-toggle>
        <div class="user-info">
          <div class="user-avatar">
            {{ currentUser()!.firstName?.charAt(0) || ''
            }}{{ currentUser()!.lastName?.charAt(0) || '' }}
          </div>
          <div class="user-details">
            <span class="user-name"
              >{{ currentUser()!.firstName }} {{ currentUser()!.lastName }}</span
            >
            <span class="user-role">{{ currentUser()!.role }}</span>
          </div>
        </div>
        <button class="logout-btn" (click)="onLogout()">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
            <polyline points="16 17 21 12 16 7"></polyline>
            <line x1="21" y1="12" x2="9" y2="12"></line>
          </svg>
          Logout
        </button>
        }
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="dashboard-main">
    <!-- Page Header -->
    <div class="page-header">
      <div class="header-left">
        <h1>My Courses</h1>
        <p>Manage and organize your courses</p>
      </div>
      <button class="create-btn" (click)="createCourse()">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        Create Course
      </button>
    </div>

    <!-- Filter Tabs -->
    <div class="filter-tabs">
      <button
        class="filter-tab"
        [class.active]="filterStatus() === 'all'"
        (click)="setFilter('all')"
      >
        All Courses
      </button>
      <button
        class="filter-tab"
        [class.active]="filterStatus() === 'published'"
        (click)="setFilter('published')"
      >
        Published
      </button>
      <button
        class="filter-tab"
        [class.active]="filterStatus() === 'draft'"
        (click)="setFilter('draft')"
      >
        Drafts
      </button>
    </div>

    <!-- Loading State -->
    @if (isLoading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Loading courses...</p>
    </div>
    }

    <!-- Empty State -->
    @if (!isLoading() && filteredCourses().length === 0) {
    <div class="empty-state">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="80"
        height="80"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="1"
      >
        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
      </svg>
      <h3>No courses found</h3>
      <p>Start creating courses to share your knowledge</p>
      <button class="create-btn" (click)="createCourse()">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        Create Your First Course
      </button>
    </div>
    }

    <!-- Courses Grid -->
    @if (!isLoading() && filteredCourses().length > 0) {
    <div class="courses-grid">
      @for (course of filteredCourses(); track course.id) {
      <div class="course-card">
        <div class="course-header">
          <span class="course-category">{{ course.category_name || 'Uncategorized' }}</span>
          <span class="course-status" [class]="'status-' + course.status">
            {{ course.status }}
          </span>
        </div>

        <div class="course-content" (click)="viewCourse(course.id)">
          <h3>{{ course.title }}</h3>
          <div class="course-stats">
            <div class="stat">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
              </svg>
              <span>{{ course.student_count || 0 }} students</span>
            </div>
            <div class="stat">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
              </svg>
              <span>{{ formatDate(course.created_at) }}</span>
            </div>
          </div>
        </div>

        <div class="course-actions">
          <button class="action-btn edit" (click)="editCourse(course.id)" title="Edit Course">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
          </button>

          <button class="action-btn view" (click)="viewStudents(course.id)" title="View Students">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
          </button>

          @if (course.status === 'draft') {
          <button
            class="action-btn publish"
            (click)="publishCourse(course.id, $event)"
            title="Publish Course"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polyline points="17 1 21 5 17 9"></polyline>
              <path d="M3 11V9a4 4 0 0 1 4-4h14"></path>
            </svg>
          </button>
          }

          <button
            class="action-btn delete"
            (click)="confirmDelete(course, $event)"
            title="Delete Course"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polyline points="3 6 5 6 21 6"></polyline>
              <path
                d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
              ></path>
            </svg>
          </button>
        </div>
      </div>
      }
    </div>
    }
  </main>
</div>

<!-- Delete Confirmation Dialog -->
@if (showDeleteDialog()) {
<app-confirmation-dialog
  [title]="'Delete Course'"
  [message]="
    'Are you sure you want to delete &quot;' +
    selectedCourseForDelete()?.title +
    '&quot;? This action cannot be undone.'
  "
  [confirmText]="'Delete'"
  [cancelText]="'Cancel'"
  [isProcessing]="isDeleting()"
  (confirmed)="deleteCourse()"
  (cancelled)="cancelDelete()"
></app-confirmation-dialog>
}
