<div class="dashboard-container">
  <main class="dashboard-main">
    <header class="profile-header">
      <button class="back-btn" (click)="goBack()">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <line x1="19" y1="12" x2="5" y2="12"></line>
          <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
        <span>{{ isEditMode() ? 'Back to Courses' : 'Back to Dashboard' }}</span>
      </button>
      <app-theme-toggle></app-theme-toggle>
    </header>

    <div class="create-course-container">
      <!-- Page Header -->
      <div class="page-header">
        <h1>{{ isEditMode() ? 'Edit Course' : 'Create New Course' }}</h1>
        <p>Share your knowledge with students around the world</p>
      </div>

      <!-- Progress Steps -->
      <div class="progress-steps">
        <div class="step" [class.active]="currentStep() >= 1" [class.completed]="currentStep() > 1">
          <div class="step-number">1</div>
          <div class="step-label">Basic Info</div>
        </div>
        <div class="step-line" [class.active]="currentStep() >= 2"></div>
        <div class="step" [class.active]="currentStep() >= 2" [class.completed]="currentStep() > 2">
          <div class="step-number">2</div>
          <div class="step-label">Details</div>
        </div>
        <div class="step-line" [class.active]="currentStep() >= 3"></div>
        <div class="step" [class.active]="currentStep() >= 3">
          <div class="step-number">3</div>
          <div class="step-label">Review</div>
        </div>
      </div>

      <!-- Form -->
      <form [formGroup]="courseForm" (ngSubmit)="onSubmit()">
        <!-- Step 1: Basic Information -->
        @if (currentStep() === 1) {
        <div class="form-step">
          <h2>Basic Information</h2>

          <div class="form-group">
            <label for="title">Course Title *</label>
            <input
              type="text"
              id="title"
              formControlName="title"
              placeholder="e.g., Complete Web Development Bootcamp"
              [class.error]="isFieldInvalid('title')"
            />
            @if (isFieldInvalid('title')) {
            <span class="error-message">{{ getErrorMessage('title') }}</span>
            }
          </div>

          <div class="form-group">
            <label for="short_description">Short Description *</label>
            <textarea
              id="short_description"
              formControlName="short_description"
              rows="3"
              placeholder="A brief overview of what students will learn (max 500 characters)"
              [class.error]="isFieldInvalid('short_description')"
            ></textarea>
            @if (isFieldInvalid('short_description')) {
            <span class="error-message">{{ getErrorMessage('short_description') }}</span>
            }
          </div>

          <div class="form-group">
            <label for="category_id">Category *</label>
            <select
              id="category_id"
              formControlName="category_id"
              [class.error]="isFieldInvalid('category_id')"
            >
              <option value="">Select a category</option>
              @for (category of categories(); track category.id) {
              <option [value]="category.id">{{ category.name }}</option>
              }
            </select>
            @if (isFieldInvalid('category_id')) {
            <span class="error-message">{{ getErrorMessage('category_id') }}</span>
            }
          </div>
        </div>
        }

        <!-- Step 2: Detailed Information -->
        @if (currentStep() === 2) {
        <div class="form-step">
          <h2>Course Details</h2>

          <div class="form-group">
            <label for="description">Full Description *</label>
            <textarea
              id="description"
              formControlName="description"
              rows="8"
              placeholder="Provide a detailed description of your course, what students will learn, prerequisites, etc."
              [class.error]="isFieldInvalid('description')"
            ></textarea>
            @if (isFieldInvalid('description')) {
            <span class="error-message">{{ getErrorMessage('description') }}</span>
            }
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="level">Difficulty Level *</label>
              <select id="level" formControlName="level">
                <option value="beginner">Beginner</option>
                <option value="intermediate">Intermediate</option>
                <option value="advanced">Advanced</option>
              </select>
            </div>

            <div class="form-group">
              <label for="language">Language *</label>
              <input type="text" id="language" formControlName="language" placeholder="English" />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="price">Price (USD) *</label>
              <input
                type="number"
                id="price"
                formControlName="price"
                min="0"
                step="0.01"
                placeholder="0.00"
              />
              <small>Set to 0 for a free course</small>
            </div>

            <div class="form-group">
              <label for="thumbnail_url">Thumbnail URL</label>
              <input
                type="url"
                id="thumbnail_url"
                formControlName="thumbnail_url"
                placeholder="https://example.com/image.jpg"
              />
              <small>Optional: Add a course thumbnail image URL</small>
            </div>
          </div>
        </div>
        }

        <!-- Step 3: Review -->
        @if (currentStep() === 3) {
        <div class="form-step">
          <h2>Review Your Course</h2>

          <div class="review-card">
            <h3>{{ courseForm.get('title')?.value }}</h3>
            <p class="short-desc">{{ courseForm.get('short_description')?.value }}</p>

            <div class="review-details">
              <div class="detail-item">
                <strong>Category:</strong>
                <span>
                  @for (cat of categories(); track cat.id) { @if (cat.id ==
                  courseForm.get('category_id')?.value) {
                  {{ cat.name }}
                  } }
                </span>
              </div>
              <div class="detail-item">
                <strong>Level:</strong>
                <span class="badge">{{ courseForm.get('level')?.value }}</span>
              </div>
              <div class="detail-item">
                <strong>Language:</strong>
                <span>{{ courseForm.get('language')?.value }}</span>
              </div>
              <div class="detail-item">
                <strong>Price:</strong>
                <span class="price">
                  @if (courseForm.get('price')?.value == 0) { Free } @else { ${{
                    courseForm.get('price')?.value
                  }}
                  }
                </span>
              </div>
            </div>

            <div class="full-description">
              <strong>Description:</strong>
              <p>{{ courseForm.get('description')?.value }}</p>
            </div>
          </div>
        </div>
        }

        <!-- Navigation Buttons -->
        <div class="form-actions">
          @if (currentStep() > 1) {
          <button type="button" class="btn-secondary" (click)="previousStep()">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="19" y1="12" x2="5" y2="12"></line>
              <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
            <span>Previous</span>
          </button>
          } @if (currentStep() < totalSteps) {
          <button type="button" class="btn-primary" (click)="nextStep()">
            <span>Next Step</span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </button>
          } @if (currentStep() === totalSteps) {
          <button type="submit" class="btn-success" [disabled]="loading()">
            @if (loading()) {
            <div class="btn-spinner"></div>
            <span>{{ isEditMode() ? 'Updating...' : 'Creating...' }}</span>
            } @else {
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            <span>{{ isEditMode() ? 'Update Course' : 'Create Course' }}</span>
            }
          </button>
          }
        </div>
      </form>
    </div>
  </main>
</div>
